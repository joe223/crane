"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.validateBuildConfig = validateBuildConfig;
exports.resolvePath = resolvePath;
exports.createBuilderConfig = createBuilderConfig;
exports.builder = builder;

var _path = _interopRequireDefault(require("path"));

var _shared = require("@cranejs/shared");

var _miniCssExtractPlugin = _interopRequireDefault(require("mini-css-extract-plugin"));

var _webpack = _interopRequireDefault(require("webpack"));

var _webpackDevServer = _interopRequireDefault(require("webpack-dev-server"));

var _webpackMerge = _interopRequireDefault(require("webpack-merge"));

var _copyWebpackPlugin = _interopRequireDefault(require("copy-webpack-plugin"));

var _htmlWebpackPlugin = _interopRequireDefault(require("html-webpack-plugin"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const cwd = process.cwd();

function validateBuildConfig(buildConfig, moduleName) {
  if (!buildConfig.entry && (!buildConfig.entries || buildConfig.entries.length === 0)) {
    _shared.logger.error(`module [${moduleName}] required a entry`);

    process.exit(1);
  }
}

function resolvePath(filePath) {
  return _path.default.isAbsolute(filePath) ? filePath : _path.default.join(cwd, './modules', filePath);
}

function createBuilderConfig(buildConfig, moduleName, clientEnv, buildType) {
  validateBuildConfig(buildConfig, moduleName);
  const conf = {
    entry: {},
    plugins: []
  };

  const configBuilder = require(`./webpackConfig/webpack.${buildType}.conf`);

  buildConfig.output = buildConfig.output || moduleName; // Single entry file

  if (buildConfig.entry) {
    const defaultEntryName = 'index';
    const entry = buildConfig;
    entry.templateParameters = {
      WEB_ENV: clientEnv,
      ...entry.templateParameters
    };
    conf.entry[defaultEntryName] = resolvePath(entry.entry);
    conf.plugins.push(genHtmlWebpackPluginConfig(buildType, entry, defaultEntryName, 'index.html')); // Multiple entry file
  } else {
    Object.keys(buildConfig.entries).forEach(entryName => {
      const entry = buildConfig.entries[entryName];
      entry.templateParameters = {
        WEB_ENV: clientEnv,
        ...entry.templateParameters
      };
      conf.entry[entryName] = resolvePath(entry.entry);
      conf.plugins.push(genHtmlWebpackPluginConfig(buildType, entry, entryName, entry.output || `${entryName}/index.html`));
    });
  }

  if (buildType === _shared.BuildType.prod) {
    conf.plugins.push(new _miniCssExtractPlugin.default({
      // Options similar to the same options in webpackOptions.output
      // both options are optional
      filename: buildType === _shared.BuildType.prod ? '[name].[chunkhash].css' : '[name].css',
      chunkFilename: buildType === _shared.BuildType.prod ? '[id].[chunkhash].css' : '[id].css'
    }));
  } // conf.plugins.push(...customPlugins.pluginsList)
  // Set public static assets
  // copy custom static assets


  if (buildConfig.static) {
    const staticAssets = [{
      from: resolvePath(buildConfig.static),
      to: _shared.config.assetsSubDirectory,
      globOptions: {
        dot: false
      }
    }];
    conf.plugins.push(new _copyWebpackPlugin.default({
      patterns: staticAssets,
      options: {
        concurrency: 100
      }
    }));
  }

  const webpackConfig = (0, _webpackMerge.default)(configBuilder(buildConfig), {
    output: {
      path: _path.default.join(_shared.config.assetsRoot, buildConfig.output),
      filename: '[name].[chunkhash].js',
      publicPath: _path.default.join(_path.default.sep, buildConfig.output, _path.default.sep)
    },
    plugins: [new _webpack.default.EnvironmentPlugin(clientEnv)]
  }, conf, buildConfig.webpack || {});
  return webpackConfig;
}

function builder(builderConfig, dev = false) {
  if (dev) {
    const options = _shared.config.devServer;
    const server = new _webpackDevServer.default((0, _webpack.default)(builderConfig), options);
    server.listen(options.port, 'localhost', function (err) {
      if (err) {
        console.log(err);
      }

      console.log('WebpackDevServer listening at localhost:', options.port);
    });
  } else {
    const compiler = (0, _webpack.default)(builderConfig);
    compiler.run((err, stats) => {
      if (err) {
        console.log(err);
      } else {
        console.log(stats);
      }
    });
  }
}
/**
 * The default for options.templateParameter
 * Generate the template parameters
 */


function genTemplateParametersGenerator(entry) {
  return function templateParametersGenerator(compilation, assets, options) {
    // Try to use absolute path while loading stylesheet
    if (assets.extracted && assets.extracted.css) {
      assets.extracted.css.forEach(css => {
        if (!_path.default.isAbsolute(css.file) && css.file.indexOf(assets.publicPath) < 0) {
          css.file = _path.default.join(assets.publicPath, css.file);
        }
      });
    }

    return {
      title: entry.title || entry.templateParameters.title,
      ...entry.templateParameters,
      compilation,
      webpackConfig: entry.options,
      htmlWebpackPlugin: {
        files: assets,
        options: options
      }
    };
  };
}
/**
 * Factory function for generating HTMLWebpackPlugin instance
 * @param {string} buildType 'dev' | 'prod'
 * @param {{
 *  title,
 *  entry,
 *  output,
 *  template?,
 *  templateParameters?}} entry
 * @param entryName
 * @param {string} htmlFilename
 * @returns {HtmlWebpackPlugin}
 */


function genHtmlWebpackPluginConfig(buildType, entry, entryName, filename = 'index.html') {
  const template = entry.template ? resolvePath(entry.template) : _shared.config.defaultTemplate;

  if (buildType === _shared.BuildType.dev) {
    return new _htmlWebpackPlugin.default({
      filename,
      template,
      inject: true,
      chunks: ['vendors', entryName],
      title: entry.title || entry.templateParameters.title,
      templateParameters: genTemplateParametersGenerator(entry)
    });
  } else {
    return new _htmlWebpackPlugin.default({
      filename,
      template,
      inject: true,
      chunks: ['vendors', entryName],
      title: entry.title || entry.templateParameters.title,
      templateParameters: genTemplateParametersGenerator(entry),
      minify: {
        removeComments: true,
        collapseWhitespace: true,
        removeAttributeQuotes: true // more options:
        // https://github.com/kangax/html-minifier#options-quick-reference

      },
      // necessary to consistently work with multiple chunks via CommonsChunkPlugin
      chunksSortMode: 'auto'
    });
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJjd2QiLCJwcm9jZXNzIiwidmFsaWRhdGVCdWlsZENvbmZpZyIsImJ1aWxkQ29uZmlnIiwibW9kdWxlTmFtZSIsImVudHJ5IiwiZW50cmllcyIsImxlbmd0aCIsImxvZ2dlciIsImVycm9yIiwiZXhpdCIsInJlc29sdmVQYXRoIiwiZmlsZVBhdGgiLCJwYXRoIiwiaXNBYnNvbHV0ZSIsImpvaW4iLCJjcmVhdGVCdWlsZGVyQ29uZmlnIiwiY2xpZW50RW52IiwiYnVpbGRUeXBlIiwiY29uZiIsInBsdWdpbnMiLCJjb25maWdCdWlsZGVyIiwicmVxdWlyZSIsIm91dHB1dCIsImRlZmF1bHRFbnRyeU5hbWUiLCJ0ZW1wbGF0ZVBhcmFtZXRlcnMiLCJXRUJfRU5WIiwicHVzaCIsImdlbkh0bWxXZWJwYWNrUGx1Z2luQ29uZmlnIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJlbnRyeU5hbWUiLCJCdWlsZFR5cGUiLCJwcm9kIiwiTWluaUNzc0V4dHJhY3RQbHVnaW4iLCJmaWxlbmFtZSIsImNodW5rRmlsZW5hbWUiLCJzdGF0aWMiLCJzdGF0aWNBc3NldHMiLCJmcm9tIiwidG8iLCJjb25maWciLCJhc3NldHNTdWJEaXJlY3RvcnkiLCJnbG9iT3B0aW9ucyIsImRvdCIsIkNvcHlXZWJwYWNrUGx1Z2luIiwicGF0dGVybnMiLCJvcHRpb25zIiwiY29uY3VycmVuY3kiLCJ3ZWJwYWNrQ29uZmlnIiwiYXNzZXRzUm9vdCIsInB1YmxpY1BhdGgiLCJzZXAiLCJ3ZWJwYWNrIiwiRW52aXJvbm1lbnRQbHVnaW4iLCJidWlsZGVyIiwiYnVpbGRlckNvbmZpZyIsImRldiIsImRldlNlcnZlciIsInNlcnZlciIsIldlYnBhY2tEZXZTZXJ2ZXIiLCJsaXN0ZW4iLCJwb3J0IiwiZXJyIiwiY29uc29sZSIsImxvZyIsImNvbXBpbGVyIiwicnVuIiwic3RhdHMiLCJnZW5UZW1wbGF0ZVBhcmFtZXRlcnNHZW5lcmF0b3IiLCJ0ZW1wbGF0ZVBhcmFtZXRlcnNHZW5lcmF0b3IiLCJjb21waWxhdGlvbiIsImFzc2V0cyIsImV4dHJhY3RlZCIsImNzcyIsImZpbGUiLCJpbmRleE9mIiwidGl0bGUiLCJodG1sV2VicGFja1BsdWdpbiIsImZpbGVzIiwidGVtcGxhdGUiLCJkZWZhdWx0VGVtcGxhdGUiLCJIdG1sV2VicGFja1BsdWdpbiIsImluamVjdCIsImNodW5rcyIsIm1pbmlmeSIsInJlbW92ZUNvbW1lbnRzIiwiY29sbGFwc2VXaGl0ZXNwYWNlIiwicmVtb3ZlQXR0cmlidXRlUXVvdGVzIiwiY2h1bmtzU29ydE1vZGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU1BLEdBQUcsR0FBR0MsT0FBTyxDQUFDRCxHQUFSLEVBQVo7O0FBRU8sU0FBU0UsbUJBQVQsQ0FBNkJDLFdBQTdCLEVBQTBDQyxVQUExQyxFQUFzRDtBQUN6RCxNQUNJLENBQUNELFdBQVcsQ0FBQ0UsS0FBYixLQUNDLENBQUNGLFdBQVcsQ0FBQ0csT0FBYixJQUF3QkgsV0FBVyxDQUFDRyxPQUFaLENBQW9CQyxNQUFwQixLQUErQixDQUR4RCxDQURKLEVBR0U7QUFDRUMsbUJBQU9DLEtBQVAsQ0FBYyxXQUFVTCxVQUFXLG9CQUFuQzs7QUFDQUgsSUFBQUEsT0FBTyxDQUFDUyxJQUFSLENBQWEsQ0FBYjtBQUNIO0FBQ0o7O0FBRU0sU0FBU0MsV0FBVCxDQUFxQkMsUUFBckIsRUFBK0I7QUFDbEMsU0FBT0MsY0FBS0MsVUFBTCxDQUFnQkYsUUFBaEIsSUFDREEsUUFEQyxHQUVEQyxjQUFLRSxJQUFMLENBQVVmLEdBQVYsRUFBZSxXQUFmLEVBQTRCWSxRQUE1QixDQUZOO0FBR0g7O0FBRU0sU0FBU0ksbUJBQVQsQ0FDSGIsV0FERyxFQUVIQyxVQUZHLEVBR0hhLFNBSEcsRUFJSEMsU0FKRyxFQUtMO0FBQ0VoQixFQUFBQSxtQkFBbUIsQ0FBQ0MsV0FBRCxFQUFjQyxV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QVlyRCxTQUFaLENBSmlCO0FBS3pCOEMsTUFBQUEsS0FBSyxFQUFFekUsS0FBSyxDQUFDeUUsS0FBTixJQUFlekUsS0FBSyxDQUFDb0Isa0JBQU4sQ0FBeUJxRCxLQUx0QjtBQU16QnJELE1BQUFBLGtCQUFrQixFQUFFNkMsOEJBQThCLENBQUNqRSxLQUFELENBTnpCO0FBT3pCaUYsTUFBQUEsTUFBTSxFQUFFO0FBQ0pDLFFBQUFBLGNBQWMsRUFBRSxJQURaO0FBRUpDLFFBQUFBLGtCQUFrQixFQUFFLElBRmhCO0FBR0pDLFFBQUFBLHFCQUFxQixFQUFFLElBSG5CLENBSUo7QUFDQTs7QUFMSSxPQVBpQjtBQWN6QjtBQUNBQyxNQUFBQSxjQUFjLEVBQUU7QUFmUyxLQUF0QixDQUFQO0FBaUJIO0FBQ0oiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuaW1wb3J0IHsgY29uZmlnLCBsb2dnZXIsIEJ1aWxkVHlwZSB9IGZyb20gJ0BjcmFuZWpzL3NoYXJlZCdcbmltcG9ydCBNaW5pQ3NzRXh0cmFjdFBsdWdpbiBmcm9tICdtaW5pLWNzcy1leHRyYWN0LXBsdWdpbidcbmltcG9ydCB3ZWJwYWNrIGZyb20gJ3dlYnBhY2snXG5pbXBvcnQgV2VicGFja0RldlNlcnZlciBmcm9tICd3ZWJwYWNrLWRldi1zZXJ2ZXInXG5pbXBvcnQgbWVyZ2UgZnJvbSAnd2VicGFjay1tZXJnZSdcbmltcG9ydCBDb3B5V2VicGFja1BsdWdpbiBmcm9tICdjb3B5LXdlYnBhY2stcGx1Z2luJ1xuaW1wb3J0IEh0bWxXZWJwYWNrUGx1Z2luIGZyb20gJ2h0bWwtd2VicGFjay1wbHVnaW4nXG5cbmNvbnN0IGN3ZCA9IHByb2Nlc3MuY3dkKClcblxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQnVpbGRDb25maWcoYnVpbGRDb25maWcsIG1vZHVsZU5hbWUpIHtcbiAgICBpZiAoXG4gICAgICAgICFidWlsZENvbmZpZy5lbnRyeSAmJlxuICAgICAgICAoIWJ1aWxkQ29uZmlnLmVudHJpZXMgfHwgYnVpbGRDb25maWcuZW50cmllcy5sZW5ndGggPT09IDApXG4gICAgKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihgbW9kdWxlIFske21vZHVsZU5hbWV9XSByZXF1aXJlZCBhIGVudHJ5YClcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpXG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVzb2x2ZVBhdGgoZmlsZVBhdGgpIHtcbiAgICByZXR1cm4gcGF0aC5pc0Fic29sdXRlKGZpbGVQYXRoKVxuICAgICAgICA/IGZpbGVQYXRoXG4gICAgICAgIDogcGF0aC5qb2luKGN3ZCwgJy4vbW9kdWxlcycsIGZpbGVQYXRoKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQnVpbGRlckNvbmZpZyhcbiAgICBidWlsZENvbmZpZyxcbiAgICBtb2R1bGVOYW1lLFxuICAgIGNsaWVudEVudixcbiAgICBidWlsZFR5cGVcbikge1xuICAgIHZhbGlkYXRlQnVpbGRDb25maWcoYnVpbGRDb25maWcsIG1vZHVsZU5hbWUpXG5cbiAgICBjb25zdCBjb25mID0ge1xuICAgICAgICBlbnRyeToge30sXG4gICAgICAgIHBsdWdpbnM6IFtdLFxuICAgIH1cbiAgICBjb25zdCBjb25maWdCdWlsZGVyID0gcmVxdWlyZShgLi93ZWJwYWNrQ29uZmlnL3dlYnBhY2suJHtidWlsZFR5cGV9LmNvbmZgKVxuXG4gICAgYnVpbGRDb25maWcub3V0cHV0ID0gYnVpbGRDb25maWcub3V0cHV0IHx8IG1vZHVsZU5hbWVcblxuICAgIC8vIFNpbmdsZSBlbnRyeSBmaWxlXG4gICAgaWYgKGJ1aWxkQ29uZmlnLmVudHJ5KSB7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRFbnRyeU5hbWUgPSAnaW5kZXgnXG4gICAgICAgIGNvbnN0IGVudHJ5ID0gYnVpbGRDb25maWdcblxuICAgICAgICBlbnRyeS50ZW1wbGF0ZVBhcmFtZXRlcnMgPSB7XG4gICAgICAgICAgICBXRUJfRU5WOiBjbGllbnRFbnYsXG4gICAgICAgICAgICAuLi5lbnRyeS50ZW1wbGF0ZVBhcmFtZXRlcnMsXG4gICAgICAgIH1cblxuICAgICAgICBjb25mLmVudHJ5W2RlZmF1bHRFbnRyeU5hbWVdID0gcmVzb2x2ZVBhdGgoZW50cnkuZW50cnkpXG4gICAgICAgIGNvbmYucGx1Z2lucy5wdXNoKFxuICAgICAgICAgICAgZ2VuSHRtbFdlYnBhY2tQbHVnaW5Db25maWcoXG4gICAgICAgICAgICAgICAgYnVpbGRUeXBlLFxuICAgICAgICAgICAgICAgIGVudHJ5LFxuICAgICAgICAgICAgICAgIGRlZmF1bHRFbnRyeU5hbWUsXG4gICAgICAgICAgICAgICAgJ2luZGV4Lmh0bWwnXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLy8gTXVsdGlwbGUgZW50cnkgZmlsZVxuICAgIH0gZWxzZSB7XG4gICAgICAgIE9iamVjdC5rZXlzKGJ1aWxkQ29uZmlnLmVudHJpZXMpLmZvckVhY2goKGVudHJ5TmFtZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZW50cnkgPSBidWlsZENvbmZpZy5lbnRyaWVzW2VudHJ5TmFtZV1cblxuICAgICAgICAgICAgZW50cnkudGVtcGxhdGVQYXJhbWV0ZXJzID0ge1xuICAgICAgICAgICAgICAgIFdFQl9FTlY6IGNsaWVudEVudixcbiAgICAgICAgICAgICAgICAuLi5lbnRyeS50ZW1wbGF0ZVBhcmFtZXRlcnMsXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbmYuZW50cnlbZW50cnlOYW1lXSA9IHJlc29sdmVQYXRoKGVudHJ5LmVudHJ5KVxuICAgICAgICAgICAgY29uZi5wbHVnaW5zLnB1c2goXG4gICAgICAgICAgICAgICAgZ2VuSHRtbFdlYnBhY2tQbHVnaW5Db25maWcoXG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkVHlwZSxcbiAgICAgICAgICAgICAgICAgICAgZW50cnksXG4gICAgICAgICAgICAgICAgICAgIGVudHJ5TmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZW50cnkub3V0cHV0IHx8IGAke2VudHJ5TmFtZX0vaW5kZXguaHRtbGBcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgIH0pXG4gICAgfVxuICAgIGlmIChidWlsZFR5cGUgPT09IEJ1aWxkVHlwZS5wcm9kKSB7XG4gICAgICAgIGNvbmYucGx1Z2lucy5wdXNoKFxuICAgICAgICAgICAgbmV3IE1pbmlDc3NFeHRyYWN0UGx1Z2luKHtcbiAgICAgICAgICAgICAgICAvLyBPcHRpb25zIHNpbWlsYXIgdG8gdGhlIHNhbWUgb3B0aW9ucyBpbiB3ZWJwYWNrT3B0aW9ucy5vdXRwdXRcbiAgICAgICAgICAgICAgICAvLyBib3RoIG9wdGlvbnMgYXJlIG9wdGlvbmFsXG4gICAgICAgICAgICAgICAgZmlsZW5hbWU6XG4gICAgICAgICAgICAgICAgICAgIGJ1aWxkVHlwZSA9PT0gQnVpbGRUeXBlLnByb2RcbiAgICAgICAgICAgICAgICAgICAgICAgID8gJ1tuYW1lXS5bY2h1bmtoYXNoXS5jc3MnXG4gICAgICAgICAgICAgICAgICAgICAgICA6ICdbbmFtZV0uY3NzJyxcbiAgICAgICAgICAgICAgICBjaHVua0ZpbGVuYW1lOlxuICAgICAgICAgICAgICAgICAgICBidWlsZFR5cGUgPT09IEJ1aWxkVHlwZS5wcm9kXG4gICAgICAgICAgICAgICAgICAgICAgICA/ICdbaWRdLltjaHVua2hhc2hdLmNzcydcbiAgICAgICAgICAgICAgICAgICAgICAgIDogJ1tpZF0uY3NzJyxcbiAgICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICB9XG5cbiAgICAvLyBjb25mLnBsdWdpbnMucHVzaCguLi5jdXN0b21QbHVnaW5zLnBsdWdpbnNMaXN0KVxuXG4gICAgLy8gU2V0IHB1YmxpYyBzdGF0aWMgYXNzZXRzXG4gICAgLy8gY29weSBjdXN0b20gc3RhdGljIGFzc2V0c1xuICAgIGlmIChidWlsZENvbmZpZy5zdGF0aWMpIHtcbiAgICAgICAgY29uc3Qgc3RhdGljQXNzZXRzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGZyb206IHJlc29sdmVQYXRoKGJ1aWxkQ29uZmlnLnN0YXRpYyksXG4gICAgICAgICAgICAgICAgdG86IGNvbmZpZy5hc3NldHNTdWJEaXJlY3RvcnksXG4gICAgICAgICAgICAgICAgZ2xvYk9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgZG90OiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgXVxuXG4gICAgICAgIGNvbmYucGx1Z2lucy5wdXNoKFxuICAgICAgICAgICAgbmV3IENvcHlXZWJwYWNrUGx1Z2luKHtcbiAgICAgICAgICAgICAgICBwYXR0ZXJuczogc3RhdGljQXNzZXRzLFxuICAgICAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgICAgY29uY3VycmVuY3k6IDEwMCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgIH1cblxuICAgIGNvbnN0IHdlYnBhY2tDb25maWcgPSBtZXJnZShcbiAgICAgICAgY29uZmlnQnVpbGRlcihidWlsZENvbmZpZyksXG4gICAgICAgIHtcbiAgICAgICAgICAgIG91dHB1dDoge1xuICAgICAgICAgICAgICAgIHBhdGg6IHBhdGguam9pbihjb25maWcuYXNzZXRzUm9vdCwgYnVpbGRDb25maWcub3V0cHV0KSxcbiAgICAgICAgICAgICAgICBmaWxlbmFtZTogJ1tuYW1lXS5bY2h1bmtoYXNoXS5qcycsXG4gICAgICAgICAgICAgICAgcHVibGljUGF0aDogcGF0aC5qb2luKHBhdGguc2VwLCBidWlsZENvbmZpZy5vdXRwdXQsIHBhdGguc2VwKSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwbHVnaW5zOiBbbmV3IHdlYnBhY2suRW52aXJvbm1lbnRQbHVnaW4oY2xpZW50RW52KV0sXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmYsXG4gICAgICAgIGJ1aWxkQ29uZmlnLndlYnBhY2sgfHwge31cbiAgICApXG5cbiAgICByZXR1cm4gd2VicGFja0NvbmZpZ1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRlcihidWlsZGVyQ29uZmlnLCBkZXYgPSBmYWxzZSkge1xuICAgIGlmIChkZXYpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9ucyA9IGNvbmZpZy5kZXZTZXJ2ZXJcbiAgICAgICAgY29uc3Qgc2VydmVyID0gbmV3IFdlYnBhY2tEZXZTZXJ2ZXIod2VicGFjayhidWlsZGVyQ29uZmlnKSwgb3B0aW9ucylcblxuICAgICAgICBzZXJ2ZXIubGlzdGVuKG9wdGlvbnMucG9ydCwgJ2xvY2FsaG9zdCcsIGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAnV2VicGFja0RldlNlcnZlciBsaXN0ZW5pbmcgYXQgbG9jYWxob3N0OicsXG4gICAgICAgICAgICAgICAgb3B0aW9ucy5wb3J0XG4gICAgICAgICAgICApXG4gICAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgY29tcGlsZXIgPSB3ZWJwYWNrKGJ1aWxkZXJDb25maWcpXG5cbiAgICAgICAgY29tcGlsZXIucnVuKChlcnIsIHN0YXRzKSA9PiB7XG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzdGF0cylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGRlZmF1bHQgZm9yIG9wdGlvbnMudGVtcGxhdGVQYXJhbWV0ZXJcbiAqIEdlbmVyYXRlIHRoZSB0ZW1wbGF0ZSBwYXJhbWV0ZXJzXG4gKi9cbmZ1bmN0aW9uIGdlblRlbXBsYXRlUGFyYW1ldGVyc0dlbmVyYXRvcihlbnRyeSkge1xuICAgIHJldHVybiBmdW5jdGlvbiB0ZW1wbGF0ZVBhcmFtZXRlcnNHZW5lcmF0b3IoY29tcGlsYXRpb24sIGFzc2V0cywgb3B0aW9ucykge1xuICAgICAgICAvLyBUcnkgdG8gdXNlIGFic29sdXRlIHBhdGggd2hpbGUgbG9hZGluZyBzdHlsZXNoZWV0XG4gICAgICAgIGlmIChhc3NldHMuZXh0cmFjdGVkICYmIGFzc2V0cy5leHRyYWN0ZWQuY3NzKSB7XG4gICAgICAgICAgICBhc3NldHMuZXh0cmFjdGVkLmNzcy5mb3JFYWNoKChjc3MpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICFwYXRoLmlzQWJzb2x1dGUoY3NzLmZpbGUpICYmXG4gICAgICAgICAgICAgICAgICAgIGNzcy5maWxlLmluZGV4T2YoYXNzZXRzLnB1YmxpY1BhdGgpIDwgMFxuICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICBjc3MuZmlsZSA9IHBhdGguam9pbihhc3NldHMucHVibGljUGF0aCwgY3NzLmZpbGUpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdGl0bGU6IGVudHJ5LnRpdGxlIHx8IGVudHJ5LnRlbXBsYXRlUGFyYW1ldGVycy50aXRsZSxcbiAgICAgICAgICAgIC4uLmVudHJ5LnRlbXBsYXRlUGFyYW1ldGVycyxcbiAgICAgICAgICAgIGNvbXBpbGF0aW9uLFxuICAgICAgICAgICAgd2VicGFja0NvbmZpZzogZW50cnkub3B0aW9ucyxcbiAgICAgICAgICAgIGh0bWxXZWJwYWNrUGx1Z2luOiB7XG4gICAgICAgICAgICAgICAgZmlsZXM6IGFzc2V0cyxcbiAgICAgICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBGYWN0b3J5IGZ1bmN0aW9uIGZvciBnZW5lcmF0aW5nIEhUTUxXZWJwYWNrUGx1Z2luIGluc3RhbmNlXG4gKiBAcGFyYW0ge3N0cmluZ30gYnVpbGRUeXBlICdkZXYnIHwgJ3Byb2QnXG4gKiBAcGFyYW0ge3tcbiAqICB0aXRsZSxcbiAqICBlbnRyeSxcbiAqICBvdXRwdXQsXG4gKiAgdGVtcGxhdGU/LFxuICogIHRlbXBsYXRlUGFyYW1ldGVycz99fSBlbnRyeVxuICogQHBhcmFtIGVudHJ5TmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IGh0bWxGaWxlbmFtZVxuICogQHJldHVybnMge0h0bWxXZWJwYWNrUGx1Z2lufVxuICovXG5mdW5jdGlvbiBnZW5IdG1sV2VicGFja1BsdWdpbkNvbmZpZyhcbiAgICBidWlsZFR5cGUsXG4gICAgZW50cnksXG4gICAgZW50cnlOYW1lLFxuICAgIGZpbGVuYW1lID0gJ2luZGV4Lmh0bWwnXG4pIHtcbiAgICBjb25zdCB0ZW1wbGF0ZSA9IGVudHJ5LnRlbXBsYXRlXG4gICAgICAgID8gcmVzb2x2ZVBhdGgoZW50cnkudGVtcGxhdGUpXG4gICAgICAgIDogY29uZmlnLmRlZmF1bHRUZW1wbGF0ZVxuXG4gICAgaWYgKGJ1aWxkVHlwZSA9PT0gQnVpbGRUeXBlLmRldikge1xuICAgICAgICByZXR1cm4gbmV3IEh0bWxXZWJwYWNrUGx1Z2luKHtcbiAgICAgICAgICAgIGZpbGVuYW1lLFxuICAgICAgICAgICAgdGVtcGxhdGUsXG4gICAgICAgICAgICBpbmplY3Q6IHRydWUsXG4gICAgICAgICAgICBjaHVua3M6IFsndmVuZG9ycycsIGVudHJ5TmFtZV0sXG4gICAgICAgICAgICB0aXRsZTogZW50cnkudGl0bGUgfHwgZW50cnkudGVtcGxhdGVQYXJhbWV0ZXJzLnRpdGxlLFxuICAgICAgICAgICAgdGVtcGxhdGVQYXJhbWV0ZXJzOiBnZW5UZW1wbGF0ZVBhcmFtZXRlcnNHZW5lcmF0b3IoZW50cnkpXG4gICAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG5ldyBIdG1sV2VicGFja1BsdWdpbih7XG4gICAgICAgICAgICBmaWxlbmFtZSxcbiAgICAgICAgICAgIHRlbXBsYXRlLFxuICAgICAgICAgICAgaW5qZWN0OiB0cnVlLFxuICAgICAgICAgICAgY2h1bmtzOiBbJ3ZlbmRvcnMnLCBlbnRyeU5hbWVdLFxuICAgICAgICAgICAgdGl0bGU6IGVudHJ5LnRpdGxlIHx8IGVudHJ5LnRlbXBsYXRlUGFyYW1ldGVycy50aXRsZSxcbiAgICAgICAgICAgIHRlbXBsYXRlUGFyYW1ldGVyczogZ2VuVGVtcGxhdGVQYXJhbWV0ZXJzR2VuZXJhdG9yKGVudHJ5KSxcbiAgICAgICAgICAgIG1pbmlmeToge1xuICAgICAgICAgICAgICAgIHJlbW92ZUNvbW1lbnRzOiB0cnVlLFxuICAgICAgICAgICAgICAgIGNvbGxhcHNlV2hpdGVzcGFjZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICByZW1vdmVBdHRyaWJ1dGVRdW90ZXM6IHRydWUsXG4gICAgICAgICAgICAgICAgLy8gbW9yZSBvcHRpb25zOlxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9rYW5nYXgvaHRtbC1taW5pZmllciNvcHRpb25zLXF1aWNrLXJlZmVyZW5jZVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vIG5lY2Vzc2FyeSB0byBjb25zaXN0ZW50bHkgd29yayB3aXRoIG11bHRpcGxlIGNodW5rcyB2aWEgQ29tbW9uc0NodW5rUGx1Z2luXG4gICAgICAgICAgICBjaHVua3NTb3J0TW9kZTogJ2F1dG8nXG4gICAgICAgIH0pXG4gICAgfVxufVxuIl19